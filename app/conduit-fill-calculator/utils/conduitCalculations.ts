export const conduitData = {
  'EMT': {
    name: 'Electrical Metallic Tubing',
    sizes: [
      { trade: '1/2"', internal: 0.622, area: 0.304 },
      { trade: '3/4"', internal: 0.824, area: 0.533 },
      { trade: '1"', internal: 1.049, area: 0.864 },
      { trade: '1-1/4"', internal: 1.380, area: 1.496 },
      { trade: '1-1/2"', internal: 1.610, area: 2.036 },
      { trade: '2"', internal: 2.067, area: 3.356 },
      { trade: '2-1/2"', internal: 2.731, area: 5.858 },
      { trade: '3"', internal: 3.356, area: 8.846 },
      { trade: '3-1/2"', internal: 3.834, area: 11.545 },
      { trade: '4"', internal: 4.334, area: 14.753 }
    ]
  },
  'PVC Sch 40 & HDPE': {
    name: 'PVC Schedule 40 & HDPE',
    sizes: [
      { trade: '1/2"', internal: 0.602, area: 0.285 },
      { trade: '3/4"', internal: 0.804, area: 0.508 },
      { trade: '1"', internal: 1.029, area: 0.832 },
      { trade: '1-1/4"', internal: 1.360, area: 1.453 },
      { trade: '1-1/2"', internal: 1.590, area: 1.986 },
      { trade: '2"', internal: 2.047, area: 3.291 },
      { trade: '2-1/2"', internal: 2.469, area: 4.788 },
      { trade: '3"', internal: 3.042, area: 7.268 },
      { trade: '3-1/2"', internal: 3.521, area: 9.737 },
      { trade: '4"', internal: 4.021, area: 12.692 },
      { trade: '5"', internal: 5.016, area: 19.761 },
      { trade: '6"', internal: 6.031, area: 28.567 }
    ]
  },
  'PVC Sch 80': {
    name: 'PVC Schedule 80',
    sizes: [
      { trade: '1/2"', internal: 0.526, area: 0.217 },
      { trade: '3/4"', internal: 0.722, area: 0.409 },
      { trade: '1"', internal: 0.936, area: 0.688 },
      { trade: '1-1/4"', internal: 1.255, area: 1.237 },
      { trade: '1-1/2"', internal: 1.476, area: 1.711 },
      { trade: '2"', internal: 1.913, area: 2.874 },
      { trade: '2-1/2"', internal: 2.290, area: 4.119 },
      { trade: '3"', internal: 2.864, area: 6.442 },
      { trade: '3-1/2"', internal: 3.326, area: 8.688 },
      { trade: '4"', internal: 3.826, area: 11.500 },
      { trade: '5"', internal: 4.813, area: 18.194 },
      { trade: '6"', internal: 5.709, area: 25.598 }
    ]
  },
  'RMC (GRC)': {
    name: 'Rigid Metal Conduit (Galvanized Rigid Conduit)',
    sizes: [
      { trade: '1/2"', internal: 0.632, area: 0.314 },
      { trade: '3/4"', internal: 0.836, area: 0.549 },
      { trade: '1"', internal: 1.063, area: 0.887 },
      { trade: '1-1/4"', internal: 1.394, area: 1.526 },
      { trade: '1-1/2"', internal: 1.624, area: 2.071 },
      { trade: '2"', internal: 2.083, area: 3.408 },
      { trade: '2-1/2"', internal: 2.489, area: 4.866 },
      { trade: '3"', internal: 3.068, area: 7.393 },
      { trade: '3-1/2"', internal: 3.548, area: 9.887 },
      { trade: '4"', internal: 4.026, area: 12.717 },
      { trade: '5"', internal: 5.073, area: 20.212 },
      { trade: '6"', internal: 6.093, area: 29.158 }
    ]
  },
  'IMC': {
    name: 'Intermediate Metal Conduit',
    sizes: [
      { trade: '1/2"', internal: 0.660, area: 0.342 },
      { trade: '3/4"', internal: 0.864, area: 0.586 },
      { trade: '1"', internal: 1.105, area: 0.959 },
      { trade: '1-1/4"', internal: 1.448, area: 1.647 },
      { trade: '1-1/2"', internal: 1.683, area: 2.225 },
      { trade: '2"', internal: 2.150, area: 3.630 },
      { trade: '2-1/2"', internal: 2.557, area: 5.135 },
      { trade: '3"', internal: 3.176, area: 7.922 },
      { trade: '3-1/2"', internal: 3.671, area: 10.584 },
      { trade: '4"', internal: 4.166, area: 13.631 }
    ]
  },
  'Flex FMC': {
    name: 'Flexible Metal Conduit',
    sizes: [
      { trade: '3/8"', internal: 0.384, area: 0.116 },
      { trade: '1/2"', internal: 0.635, area: 0.317 },
      { trade: '3/4"', internal: 0.824, area: 0.533 },
      { trade: '1"', internal: 1.020, area: 0.817 },
      { trade: '1-1/4"', internal: 1.275, area: 1.277 },
      { trade: '1-1/2"', internal: 1.538, area: 1.858 },
      { trade: '2"', internal: 2.040, area: 3.269 }
    ]
  },
  'Flex LFMC': {
    name: 'Liquidtight Flexible Metal Conduit',
    sizes: [
      { trade: '3/8"', internal: 0.384, area: 0.116 },
      { trade: '1/2"', internal: 0.494, area: 0.192 },
      { trade: '3/4"', internal: 0.736, area: 0.425 },
      { trade: '1"', internal: 0.981, area: 0.756 },
      { trade: '1-1/4"', internal: 1.267, area: 1.262 },
      { trade: '1-1/2"', internal: 1.524, area: 1.825 },
      { trade: '2"', internal: 2.009, area: 3.169 }
    ]
  },
  'Flex LFNC-B': {
    name: 'Liquidtight Flexible Nonmetallic Conduit Type B',
    sizes: [
      { trade: '3/8"', internal: 0.384, area: 0.116 },
      { trade: '1/2"', internal: 0.494, area: 0.192 },
      { trade: '3/4"', internal: 0.736, area: 0.425 },
      { trade: '1"', internal: 0.981, area: 0.756 },
      { trade: '1-1/4"', internal: 1.267, area: 1.262 },
      { trade: '1-1/2"', internal: 1.524, area: 1.825 },
      { trade: '2"', internal: 2.009, area: 3.169 }
    ]
  },
  'SDR 9': {
    name: 'Standard Dimension Ratio 9',
    sizes: [
      { trade: '2"', internal: 2.193, area: 3.778 },
      { trade: '3"', internal: 3.284, area: 8.474 },
      { trade: '4"', internal: 4.374, area: 15.022 },
      { trade: '5"', internal: 5.465, area: 23.448 },
      { trade: '6"', internal: 6.556, area: 33.751 }
    ]
  },
  'SDR 11': {
    name: 'Standard Dimension Ratio 11',
    sizes: [
      { trade: '2"', internal: 2.193, area: 3.778 },
      { trade: '3"', internal: 3.284, area: 8.474 },
      { trade: '4"', internal: 4.374, area: 15.022 },
      { trade: '5"', internal: 5.465, area: 23.448 },
      { trade: '6"', internal: 6.556, area: 33.751 }
    ]
  },
  'SDR 13.5': {
    name: 'Standard Dimension Ratio 13.5',
    sizes: [
      { trade: '2"', internal: 2.193, area: 3.778 },
      { trade: '3"', internal: 3.284, area: 8.474 },
      { trade: '4"', internal: 4.374, area: 15.022 },
      { trade: '5"', internal: 5.465, area: 23.448 },
      { trade: '6"', internal: 6.556, area: 33.751 }
    ]
  },
  'TC-7': {
    name: 'Thermoplastic-Covered Cable Type 7',
    sizes: [
      { trade: '1/2"', internal: 0.602, area: 0.285 },
      { trade: '3/4"', internal: 0.804, area: 0.508 },
      { trade: '1"', internal: 1.029, area: 0.832 },
      { trade: '1-1/4"', internal: 1.360, area: 1.453 },
      { trade: '1-1/2"', internal: 1.590, area: 1.986 },
      { trade: '2"', internal: 2.047, area: 3.291 }
    ]
  }
};

export const conductorData = {
  'THHN/THWN (Copper)': {
    '14': { diameter: 0.111, area: 0.0097 },
    '12': { diameter: 0.130, area: 0.0133 },
    '10': { diameter: 0.164, area: 0.0211 },
    '8': { diameter: 0.216, area: 0.0366 },
    '6': { diameter: 0.275, area: 0.0507 },
    '4': { diameter: 0.324, area: 0.0824 },
    '3': { diameter: 0.352, area: 0.0973 },
    '2': { diameter: 0.384, area: 0.1158 },
    '1': { diameter: 0.448, area: 0.1576 },
    '1/0': { diameter: 0.486, area: 0.1855 },
    '2/0': { diameter: 0.532, area: 0.2223 },
    '3/0': { diameter: 0.584, area: 0.2679 },
    '4/0': { diameter: 0.642, area: 0.3237 },
    '250': { diameter: 0.711, area: 0.3970 },
    '300': { diameter: 0.766, area: 0.4608 },
    '350': { diameter: 0.817, area: 0.5242 },
    '400': { diameter: 0.864, area: 0.5863 },
    '500': { diameter: 0.953, area: 0.7127 }
  },
  'THHN/THWN (Aluminum)': {
    '12': { diameter: 0.130, area: 0.0133 },
    '10': { diameter: 0.164, area: 0.0211 },
    '8': { diameter: 0.216, area: 0.0366 },
    '6': { diameter: 0.275, area: 0.0507 },
    '4': { diameter: 0.324, area: 0.0824 },
    '3': { diameter: 0.352, area: 0.0973 },
    '2': { diameter: 0.384, area: 0.1158 },
    '1': { diameter: 0.448, area: 0.1576 },
    '1/0': { diameter: 0.486, area: 0.1855 },
    '2/0': { diameter: 0.532, area: 0.2223 },
    '3/0': { diameter: 0.584, area: 0.2679 },
    '4/0': { diameter: 0.642, area: 0.3237 },
    '250': { diameter: 0.711, area: 0.3970 },
    '300': { diameter: 0.766, area: 0.4608 },
    '350': { diameter: 0.817, area: 0.5242 },
    '400': { diameter: 0.864, area: 0.5863 },
    '500': { diameter: 0.953, area: 0.7127 }
  },
  'XHHW (Copper)': {
    '14': { diameter: 0.122, area: 0.0117 },
    '12': { diameter: 0.141, area: 0.0156 },
    '10': { diameter: 0.175, area: 0.0241 },
    '8': { diameter: 0.227, area: 0.0405 },
    '6': { diameter: 0.286, area: 0.0642 },
    '4': { diameter: 0.335, area: 0.0881 },
    '3': { diameter: 0.363, area: 0.1035 },
    '2': { diameter: 0.395, area: 0.1225 },
    '1': { diameter: 0.459, area: 0.1653 },
    '1/0': { diameter: 0.497, area: 0.1940 },
    '2/0': { diameter: 0.543, area: 0.2316 },
    '3/0': { diameter: 0.595, area: 0.2781 },
    '4/0': { diameter: 0.653, area: 0.3349 },
    '250': { diameter: 0.722, area: 0.4096 },
    '300': { diameter: 0.777, area: 0.4743 },
    '350': { diameter: 0.828, area: 0.5384 },
    '400': { diameter: 0.875, area: 0.6013 },
    '500': { diameter: 0.964, area: 0.7297 }
  },
  'XHHW (Aluminum)': {
    '12': { diameter: 0.141, area: 0.0156 },
    '10': { diameter: 0.175, area: 0.0241 },
    '8': { diameter: 0.227, area: 0.0405 },
    '6': { diameter: 0.286, area: 0.0642 },
    '4': { diameter: 0.335, area: 0.0881 },
    '3': { diameter: 0.363, area: 0.1035 },
    '2': { diameter: 0.395, area: 0.1225 },
    '1': { diameter: 0.459, area: 0.1653 },
    '1/0': { diameter: 0.497, area: 0.1940 },
    '2/0': { diameter: 0.543, area: 0.2316 },
    '3/0': { diameter: 0.595, area: 0.2781 },
    '4/0': { diameter: 0.653, area: 0.3349 },
    '250': { diameter: 0.722, area: 0.4096 },
    '300': { diameter: 0.777, area: 0.4743 },
    '350': { diameter: 0.828, area: 0.5384 },
    '400': { diameter: 0.875, area: 0.6013 },
    '500': { diameter: 0.964, area: 0.7297 }
  },
  'TW (Copper)': {
    '14': { diameter: 0.152, area: 0.0181 },
    '12': { diameter: 0.172, area: 0.0233 },
    '10': { diameter: 0.206, area: 0.0333 },
    '8': { diameter: 0.289, area: 0.0656 },
    '6': { diameter: 0.372, area: 0.1087 },
    '4': { diameter: 0.452, area: 0.1605 },
    '3': { diameter: 0.481, area: 0.1817 },
    '2': { diameter: 0.513, area: 0.2067 },
    '1': { diameter: 0.588, area: 0.2715 },
    '1/0': { diameter: 0.629, area: 0.3107 },
    '2/0': { diameter: 0.675, area: 0.3578 },
    '3/0': { diameter: 0.727, area: 0.4151 },
    '4/0': { diameter: 0.785, area: 0.4840 }
  },
  'THW (Copper)': {
    '14': { diameter: 0.152, area: 0.0181 },
    '12': { diameter: 0.172, area: 0.0233 },
    '10': { diameter: 0.206, area: 0.0333 },
    '8': { diameter: 0.289, area: 0.0656 },
    '6': { diameter: 0.372, area: 0.1087 },
    '4': { diameter: 0.452, area: 0.1605 },
    '3': { diameter: 0.481, area: 0.1817 },
    '2': { diameter: 0.513, area: 0.2067 },
    '1': { diameter: 0.588, area: 0.2715 },
    '1/0': { diameter: 0.629, area: 0.3107 },
    '2/0': { diameter: 0.675, area: 0.3578 },
    '3/0': { diameter: 0.727, area: 0.4151 },
    '4/0': { diameter: 0.785, area: 0.4840 },
    '250': { diameter: 0.867, area: 0.5917 },
    '300': { diameter: 0.922, area: 0.6665 },
    '350': { diameter: 0.973, area: 0.7435 },
    '400': { diameter: 1.020, area: 0.8171 },
    '500': { diameter: 1.109, area: 0.9676 }
  },
  'THW (Aluminum)': {
    '12': { diameter: 0.172, area: 0.0233 },
    '10': { diameter: 0.206, area: 0.0333 },
    '8': { diameter: 0.289, area: 0.0656 },
    '6': { diameter: 0.372, area: 0.1087 },
    '4': { diameter: 0.452, area: 0.1605 },
    '3': { diameter: 0.481, area: 0.1817 },
    '2': { diameter: 0.513, area: 0.2067 },
    '1': { diameter: 0.588, area: 0.2715 },
    '1/0': { diameter: 0.629, area: 0.3107 },
    '2/0': { diameter: 0.675, area: 0.3578 },
    '3/0': { diameter: 0.727, area: 0.4151 },
    '4/0': { diameter: 0.785, area: 0.4840 },
    '250': { diameter: 0.867, area: 0.5917 },
    '300': { diameter: 0.922, area: 0.6665 },
    '350': { diameter: 0.973, area: 0.7435 },
    '400': { diameter: 1.020, area: 0.8171 },
    '500': { diameter: 1.109, area: 0.9676 }
  },
  'RHH/RHW (Copper)': {
    '14': { diameter: 0.193, area: 0.0293 },
    '12': { diameter: 0.213, area: 0.0353 },
    '10': { diameter: 0.247, area: 0.0479 },
    '8': { diameter: 0.330, area: 0.0855 },
    '6': { diameter: 0.413, area: 0.1338 },
    '4': { diameter: 0.493, area: 0.1907 },
    '3': { diameter: 0.522, area: 0.2137 },
    '2': { diameter: 0.554, area: 0.2406 },
    '1': { diameter: 0.629, area: 0.3107 },
    '1/0': { diameter: 0.670, area: 0.3525 },
    '2/0': { diameter: 0.716, area: 0.4026 },
    '3/0': { diameter: 0.768, area: 0.4634 },
    '4/0': { diameter: 0.826, area: 0.5356 }
  },
  'USE (Copper)': {
    '14': { diameter: 0.122, area: 0.0117 },
    '12': { diameter: 0.141, area: 0.0156 },
    '10': { diameter: 0.175, area: 0.0241 },
    '8': { diameter: 0.227, area: 0.0405 },
    '6': { diameter: 0.286, area: 0.0642 },
    '4': { diameter: 0.335, area: 0.0881 },
    '3': { diameter: 0.363, area: 0.1035 },
    '2': { diameter: 0.395, area: 0.1225 },
    '1': { diameter: 0.459, area: 0.1653 },
    '1/0': { diameter: 0.497, area: 0.1940 },
    '2/0': { diameter: 0.543, area: 0.2316 },
    '3/0': { diameter: 0.595, area: 0.2781 },
    '4/0': { diameter: 0.653, area: 0.3349 }
  }
};

interface Conductor {
  id: string;
  type: string;
  awgSize: string;
  quantity: number;
}

export type CalculationStandard = 'NEC' | 'Utility';

export function calculateConduitFill(
  conduitType: string,
  conduitSize: string,
  conductors: Conductor[],
  standard: CalculationStandard = 'NEC'
) {
  const conduit = conduitData[conduitType as keyof typeof conduitData];
  if (!conduit) {
    throw new Error('Invalid conduit type');
  }

  const sizeData = conduit.sizes.find(s => s.trade === conduitSize);
  if (!sizeData) {
    throw new Error('Invalid conduit size');
  }

  const conduitArea = sizeData.area;
  let totalConductorArea = 0;
  let conductorCount = 0;

  for (const conductor of conductors) {
    const wireData = conductorData[conductor.type as keyof typeof conductorData];
    if (!wireData) continue;

    const sizeInfo = wireData[conductor.awgSize as keyof typeof wireData];
    if (!sizeInfo) continue;

    totalConductorArea += sizeInfo.area * conductor.quantity;
    conductorCount += conductor.quantity;
  }

  // Apply 5% bend factor for conduit cross-sections
  const adjustedConduitArea = conduitArea * 0.95;
  
  let maxAllowedPercentage = 40;
  
  if (standard === 'NEC') {
    // NEC Standard fill percentages
    if (conductorCount === 1) {
      maxAllowedPercentage = 53;
    } else if (conductorCount === 2) {
      maxAllowedPercentage = 31;
    } else {
      maxAllowedPercentage = 40;
    }
  } else if (standard === 'Utility') {
    // Utility standards are typically more conservative
    if (conductorCount === 1) {
      maxAllowedPercentage = 50;
    } else if (conductorCount === 2) {
      maxAllowedPercentage = 30;
    } else {
      maxAllowedPercentage = 35;
    }
  }

  const fillPercentage = (totalConductorArea / adjustedConduitArea) * 100;
  const isCompliant = fillPercentage <= maxAllowedPercentage;

  let jamProbability = 0;
  if (conductorCount >= 3) {
    const avgConductorDiameter = Math.sqrt(totalConductorArea / conductorCount / Math.PI) * 2;
    const conduitDiameter = sizeData.internal;
    
    if (avgConductorDiameter > 0 && conduitDiameter > 0) {
      const spacingRatio = conduitDiameter / avgConductorDiameter;
      if (spacingRatio < 3) {
        jamProbability = Math.min(100, (3 - spacingRatio) * 50);
      }
    }
  }

  return {
    fillPercentage: Math.round(fillPercentage * 10) / 10,
    jamProbability: Math.round(jamProbability * 10) / 10,
    isCompliant,
    maxAllowed: maxAllowedPercentage,
    totalConductorArea: Math.round(totalConductorArea * 10000) / 10000,
    conduitArea: Math.round(adjustedConduitArea * 10000) / 10000,
    conductorCount,
    standard
  };
}